<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Compute inverse solution &#8212; ephypype 0.0.7 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Ephypype</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.7</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Gallery</a></li>
                <li><a href="../api.html">API</a></li>
                <li><a href="../tutorial/index.html">Tutorial</a></li>
                <li><a href="https://github.com/neuropycon/ephypype">Github</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Compute inverse solution</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/auto_examples/plot_inverse.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-inverse-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="compute-inverse-solution">
<span id="source-reconstruction"></span><span id="sphx-glr-auto-examples-plot-inverse-py"></span><h1>Compute inverse solution<a class="headerlink" href="#compute-inverse-solution" title="Permalink to this headline">Â¶</a></h1>
<p>The inverse solution pipeline performs source reconstruction starting either
from raw/epoched data (<em>.fif</em> format) specified by the user or from the output
of the Preprocessing pipeline (cleaned raw data).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Annalisa Pascarella &lt;a.pascarella@iac.cnr.it&gt;</span>
<span class="c1"># License: BSD (3-clause)</span>

<span class="c1"># sphinx_gallery_thumbnail_number = 2</span>

<span class="kn">import</span> <span class="nn">os.path</span> <span class="kn">as</span> <span class="nn">op</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">nipype.pipeline.engine</span> <span class="kn">as</span> <span class="nn">pe</span>

<span class="kn">import</span> <span class="nn">ephypype</span>
<span class="kn">from</span> <span class="nn">ephypype.nodes</span> <span class="kn">import</span> <span class="n">create_iterator</span><span class="p">,</span> <span class="n">create_datagrabber</span>
<span class="kn">from</span> <span class="nn">ephypype.datasets</span> <span class="kn">import</span> <span class="n">fetch_omega_dataset</span>
</pre></div>
</div>
<p>Let us fetch the data first. It is around 675 MB download.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;fif&#39;</span>
<span class="n">base_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">ephypype</span><span class="o">.</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;examples&#39;</span><span class="p">)</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="n">fetch_omega_dataset</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span>
</pre></div>
</div>
<p>then read the parameters for inverse solution from a
<a class="reference download external" download="" href="https://github.com/neuropycon/ephypype/blob/master/examples/params_inverse.json"><code class="xref download docutils literal notranslate"><span class="pre">json</span></code></a>
file and print it</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>  <span class="c1"># noqa</span>
<span class="kn">import</span> <span class="nn">pprint</span>  <span class="c1"># noqa</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;params_inverse.json&quot;</span><span class="p">))</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">({</span><span class="s1">&#39;inverse parameters&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>

<span class="n">spacing</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;spacing&#39;</span><span class="p">]</span>  <span class="c1"># ico-5 vs oct-6</span>
<span class="n">snr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;snr&#39;</span><span class="p">]</span>  <span class="c1"># use smaller SNR for raw data</span>
<span class="n">inv_method</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">]</span>  <span class="c1"># sLORETA, MNE, dSPM</span>
<span class="n">parc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;parcellation&#39;</span><span class="p">]</span>  <span class="c1"># parcellation to use: &#39;aparc&#39; vs &#39;aparc.a2009s&#39;</span>
<span class="c1"># noise covariance matrix filename template</span>
<span class="n">noise_cov_fname</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;noise_cov_fname&#39;</span><span class="p">]</span>

<span class="c1"># set sbj dir path, i.e. where the FS folfers are</span>
<span class="n">subjects_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;FSF&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;inverse parameters&#39;: {&#39;method&#39;: &#39;MNE&#39;,
                        &#39;noise_cov_fname&#39;: &#39;*noise*.ds&#39;,
                        &#39;parcellation&#39;: &#39;aparc&#39;,
                        &#39;snr&#39;: 1.0,
                        &#39;spacing&#39;: &#39;oct-6&#39;}}
</pre></div>
</div>
<p>Then, we create our workflow and specify the <cite>base_dir</cite> which tells
nipype the directory in which to store the outputs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># workflow directory within the `base_dir`</span>
<span class="n">src_reconstruction_pipeline_name</span> <span class="o">=</span> <span class="s1">&#39;source_reconstruction_&#39;</span> <span class="o">+</span> \
    <span class="n">inv_method</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">parc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">main_workflow</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">src_reconstruction_pipeline_name</span><span class="p">)</span>
<span class="n">main_workflow</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">data_path</span>
</pre></div>
</div>
<p>Then we create a node to pass input filenames to DataGrabber from nipype</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">subject_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sub-0003&#39;</span><span class="p">]</span>  <span class="c1"># &#39;sub-0004&#39;, &#39;sub-0006&#39;</span>
<span class="n">session_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ses-0001&#39;</span><span class="p">]</span>
<span class="n">infosource</span> <span class="o">=</span> <span class="n">create_iterator</span><span class="p">([</span><span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">],</span>
                             <span class="p">[</span><span class="n">subject_ids</span><span class="p">,</span> <span class="n">session_ids</span><span class="p">])</span>
</pre></div>
</div>
<p>and a node to grab data. The template_args in this node iterate upon
the values in the infosource node</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">template_path</span> <span class="o">=</span> <span class="s1">&#39;*</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">/meg/</span><span class="si">%s</span><span class="s1">*rest*0_60*ica.fif&#39;</span>
<span class="n">template_args</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">,</span> <span class="s1">&#39;subject_id&#39;</span><span class="p">]]</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">create_datagrabber</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">template_path</span><span class="p">,</span> <span class="n">template_args</span><span class="p">)</span>
</pre></div>
</div>
<p>Ephypype creates for us a pipeline which can be connected to these
nodes we created. The inverse solution pipeline is implemented by the
function
<code class="xref py py-func docutils literal notranslate"><span class="pre">ephypype.pipelines.preproc_meeg.create_pipeline_source_reconstruction()</span></code>
thus to instantiate the inverse pipeline node, we import it and pass our
parameters to it.
The inverse pipeline contains three nodes that wrap the MNE Python functions
that perform the source reconstruction steps.</p>
<p>In particular, the three nodes are:</p>
<ul class="simple">
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">ephypype.interfaces.mne.LF_computation.LFComputation</span></code> compute the
Lead Field matrix</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">ephypype.interfaces.mne.Inverse_solution.NoiseCovariance</span></code> computes
the noise covariance matrix</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">ephypype.interfaces.mne.Inverse_solution.InverseSolution</span></code> estimates
the time series of the neural sources on a set of dipoles grid</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ephypype.pipelines.fif_to_inv_sol</span> <span class="kn">import</span> <a href="http://neuropycon.github.io/ephypype/generated/ephypype.pipelines.create_pipeline_source_reconstruction.html#ephypype.pipelines.create_pipeline_source_reconstruction" title="View documentation for ephypype.pipelines.fif_to_inv_sol.create_pipeline_source_reconstruction"><span class="n">create_pipeline_source_reconstruction</span></a>  <span class="c1"># noqa</span>
<span class="n">inv_sol_workflow</span> <span class="o">=</span> <a href="http://neuropycon.github.io/ephypype/generated/ephypype.pipelines.create_pipeline_source_reconstruction.html#ephypype.pipelines.create_pipeline_source_reconstruction" title="View documentation for ephypype.pipelines.fif_to_inv_sol.create_pipeline_source_reconstruction"><span class="n">create_pipeline_source_reconstruction</span></a><span class="p">(</span>
    <span class="n">data_path</span><span class="p">,</span> <span class="n">subjects_dir</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span> <span class="n">inv_method</span><span class="o">=</span><span class="n">inv_method</span><span class="p">,</span> <span class="n">parc</span><span class="o">=</span><span class="n">parc</span><span class="p">,</span>
    <span class="n">noise_cov_fname</span><span class="o">=</span><span class="n">noise_cov_fname</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>******************** {} *noise*.ds
</pre></div>
</div>
<p>We then connect the nodes two at a time. First, we connect the two outputs
(subject_id and session_id) of the infosource node to the datasource node.
So, these two nodes taken together can grab data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">main_workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">infosource</span><span class="p">,</span> <span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">datasource</span><span class="p">,</span> <span class="s1">&#39;subject_id&#39;</span><span class="p">)</span>
<span class="n">main_workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">infosource</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">,</span> <span class="n">datasource</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Similarly, for the inputnode of the preproc_workflow. Things will become
clearer in a moment when we plot the graph of the workflow.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">main_workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">infosource</span><span class="p">,</span> <span class="s1">&#39;subject_id&#39;</span><span class="p">,</span>
                      <span class="n">inv_sol_workflow</span><span class="p">,</span> <span class="s1">&#39;inputnode.sbj_id&#39;</span><span class="p">)</span>
<span class="n">main_workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">datasource</span><span class="p">,</span> <span class="s1">&#39;raw_file&#39;</span><span class="p">,</span>
                      <span class="n">inv_sol_workflow</span><span class="p">,</span> <span class="s1">&#39;inputnode.raw&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To do so, we first write the workflow graph (optional)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">main_workflow</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph2use</span><span class="o">=</span><span class="s1">&#39;colored&#39;</span><span class="p">)</span>  <span class="c1"># colored</span>
</pre></div>
</div>
<p>and visualize it. Take a moment to pause and notice how the connections
here correspond to how we connected the nodes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>  <span class="c1"># noqa</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">src_reconstruction_pipeline_name</span><span class="p">,</span> <span class="s1">&#39;graph.png&#39;</span><span class="p">))</span>  <span class="c1"># noqa</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_inverse_001.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_inverse_001.png" />
<p>Finally, we are now ready to execute our workflow.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">main_workflow</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;execution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;remove_unnecessary_outputs&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">}</span>

<span class="c1"># Run workflow locally on 1 CPU</span>
<span class="n">main_workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">plugin</span><span class="o">=</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_procs&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
<p>The output is the source reconstruction matrix stored in the workflow
directory defined by <cite>base_dir</cite>. This matrix can be used as input of
the Connectivity pipeline.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">To use this pipeline, we need a cortical segmentation of MRI
data, that could be provided by Freesurfer</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">ephypype.gather.gather_results</span> <span class="kn">import</span> <span class="n">get_results</span>  <span class="c1"># noqa</span>
<span class="kn">from</span> <span class="nn">visbrain.objects</span> <span class="kn">import</span> <span class="n">BrainObj</span><span class="p">,</span> <span class="n">ColorbarObj</span><span class="p">,</span> <span class="n">SceneObj</span>  <span class="c1"># noqa</span>

<span class="n">time_series_files</span><span class="p">,</span> <span class="n">label_files</span> <span class="o">=</span> <span class="n">get_results</span><span class="p">(</span><span class="n">main_workflow</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span>
                                             <span class="n">main_workflow</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                             <span class="n">pipeline</span><span class="o">=</span><span class="s1">&#39;inverse&#39;</span><span class="p">)</span>

<span class="n">time_pts</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">SceneObj</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">lh_file</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="s1">&#39;fsaverage&#39;</span><span class="p">,</span> <span class="s1">&#39;label/lh.aparc.annot&#39;</span><span class="p">)</span>
<span class="n">rh_file</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subjects_dir</span><span class="p">,</span> <span class="s1">&#39;fsaverage&#39;</span><span class="p">,</span> <span class="s1">&#39;label/rh.aparc.annot&#39;</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span>
<span class="n">txtcolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
<span class="k">for</span> <span class="n">inverse_file</span><span class="p">,</span> <span class="n">label_file</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">time_series_files</span><span class="p">,</span> <span class="n">label_files</span><span class="p">):</span>
    <span class="c1"># Load files :</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">label_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">names</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;ROI_names&#39;</span><span class="p">],</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;ROI_coords&#39;</span><span class="p">],</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;ROI_colors&#39;</span><span class="p">]</span>  <span class="c1"># noqa</span>
    <span class="n">ts</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.squeeze" title="View documentation for numpy.squeeze"><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span></a><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.load" title="View documentation for numpy.load"><span class="n">np</span><span class="o">.</span><span class="n">load</span></a><span class="p">(</span><span class="n">inverse_file</span><span class="p">))</span>
    <span class="n">cen</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.array" title="View documentation for numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">])</span>

    <span class="c1"># Get the data of the left / right hemisphere :</span>
    <span class="n">lh_data</span><span class="p">,</span> <span class="n">rh_data</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="n">time_pts</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="n">time_pts</span><span class="p">]</span>
    <span class="n">clim</span> <span class="o">=</span> <span class="p">(</span><span class="n">ts</span><span class="p">[:,</span> <span class="n">time_pts</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ts</span><span class="p">[:,</span> <span class="n">time_pts</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">roi_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.array" title="View documentation for numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">(</span><span class="n">names</span><span class="p">)[::</span><span class="mi">2</span><span class="p">]]</span>

    <span class="c1"># Left hemisphere outside :</span>
    <span class="n">b_obj_li</span> <span class="o">=</span> <span class="n">BrainObj</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">translucent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">hemisphere</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">b_obj_li</span><span class="o">.</span><span class="n">parcellize</span><span class="p">(</span><span class="n">lh_file</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">roi_names</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">lh_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">add_to_subplot</span><span class="p">(</span><span class="n">b_obj_li</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

    <span class="c1"># Left hemisphere inside :</span>
    <span class="n">b_obj_lo</span> <span class="o">=</span> <span class="n">BrainObj</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>  <span class="n">translucent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">hemisphere</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">b_obj_lo</span><span class="o">.</span><span class="n">parcellize</span><span class="p">(</span><span class="n">lh_file</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">roi_names</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">lh_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">add_to_subplot</span><span class="p">(</span><span class="n">b_obj_lo</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

    <span class="c1"># Right hemisphere outside :</span>
    <span class="n">b_obj_ro</span> <span class="o">=</span> <span class="n">BrainObj</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>  <span class="n">translucent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">hemisphere</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">b_obj_ro</span><span class="o">.</span><span class="n">parcellize</span><span class="p">(</span><span class="n">rh_file</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">roi_names</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">rh_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">add_to_subplot</span><span class="p">(</span><span class="n">b_obj_ro</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

    <span class="c1"># Right hemisphere inside :</span>
    <span class="n">b_obj_ri</span> <span class="o">=</span> <span class="n">BrainObj</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>  <span class="n">translucent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">hemisphere</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">b_obj_ri</span><span class="o">.</span><span class="n">parcellize</span><span class="p">(</span><span class="n">rh_file</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">roi_names</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">rh_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">add_to_subplot</span><span class="p">(</span><span class="n">b_obj_ri</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

    <span class="c1"># Add the colorbar :</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">ColorbarObj</span><span class="p">(</span><span class="n">b_obj_li</span><span class="p">,</span> <span class="n">txtsz</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">cbtxtsz</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">txtcolor</span><span class="o">=</span><span class="n">txtcolor</span><span class="p">,</span>
                       <span class="n">cblabel</span><span class="o">=</span><span class="s1">&#39;Intensity&#39;</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">add_to_subplot</span><span class="p">(</span><span class="n">cbar</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">row_span</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">sc</span><span class="o">.</span><span class="n">preview</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_inverse_002.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_inverse_002.png" />
<p><strong>Total running time of the script:</strong> ( 0 minutes  10.145 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-inverse-py">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../_downloads/b4833c6e0e2f107adaf6f554ac59fbd3/plot_inverse.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_inverse.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../_downloads/ce399e94bb6b3c4601ec390b90ab3293/plot_inverse.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_inverse.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Neuropycon Developers. Last updated on 2020-01-16.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>